{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",

    "parameters": {

    },

    "resources": [
    { // vnet
        "name": "vnet",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2021-04-01",
        "properties": {
            "mode": "Incremental",
            "templateLink": {
                "relativePath": "artifacts/vnet.json"
            },
            "parameters": {
                "vnetName": {
                    "value": "VNet1"
                },
                "vnetAddressPrefix": {
                    "value": "172.19.0.0/16"
                },
                "subnet1Prefix": {
                    "value": "172.19.0.0/24"
                },
                "runtimeSubnetName": {
                    "value": "Subnet1"
                },
                "subnet2Prefix": {
                    "value": "172.19.1.0/24"
                },
                "appSubnetName": {
                    "value": "Subnet2"
                }
            }
        }
    },
    { // log analytics
        "name": "logAnalytics",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2021-04-01",
        "properties": {
            "mode": "Incremental",
            "templateLink": {
                "relativePath": "artifacts/logAnalytics.json"
            },
            "parameters": {
                "workspaceName": {
                    "value": "laMyWorkspace"
                },
                "sku": {
                    "value": "pergb2018"
                },
                "resourcePermissions": {
                    "value": true
                },
                "heartbeatTableRetention": {
                    "value": 30
                }
            }
        }
    },
    { // azure spring cloud
        "name": "azureSpringCloud",
        "type": "Microsoft.Resources/deployments",
        "apiVersion": "2021-04-01",
        "properties": {
            "mode": "Incremental",
            "templateLink": {
                "relativePath": "artifacts/azureSpringCloud.json"
            },
            "parameters": {
                "springCloudInstanceName": {
                    "value": "ascmyworspacesdev"
                },
                "appInsightsName": {
                    "value": "ascinsightsdev"
                },
                "springCloudServiceCidrs": {
                    "value": "172.19.0.0/16,172.19.1.0/16,172.19.2.0/16"
                },
                "laWorkspaceResourceId": {
                    "value": "[reference('logAnalytics').outputs.laWorkspaceId.value]"
                },
                "springCloudAppSubnetID": {
                    "value": "[reference('vnet').outputs.appSubnetId.value]"
                },
                "springCloudRuntimeSubnetID": {
                    "value": "[reference('vnet').outputs.runtimeSubnetId.value]"
                }
            }
        }
    }

    ]
    
  }